(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[612],{1508:(e,r,t)=>{"use strict";t.d(r,{default:()=>E});var s=t(5155),a=t(2115),n=t(6076),l=t(4071),i=t(2163),o=t(5987),c=t(8022),d=t(4249),u=t(7721),x=t(6503),f=t(3777),h=t(192),m=t(2616),p=t(7131),g=t(3736),b=t(1650);let y=(0,t(6867).A)((0,s.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete");var j=t(5727),A=t(8759),w=t(7279),v=t(7719),k=t(8781),C=t(7308),R=t(7104);function S(e){return`${e}-${Date.now()}-${Math.random().toString(16).slice(2)}`}function E(){let{llm:e,stt:r,tts:t,llmWorker:E,sttWorker:T,ttsWorker:L,systemPrompt:z,autoLoadAll:M,modelName:I}=(0,v.Q)(),[W,$]=(0,a.useState)([]),[P,D]=(0,a.useState)(""),[B,N]=(0,a.useState)(""),[_,q]=(0,a.useState)(!1),[G,H]=(0,a.useState)(!0),[O,U]=(0,a.useState)(null),[K,F]=(0,a.useState)(!1),[Q,V]=(0,a.useState)(""),Y=(0,a.useRef)(null),J=(0,a.useRef)(!0),X=(0,a.useRef)(null),Z=(0,a.useRef)(""),ee=(0,a.useRef)(null),er=(0,a.useRef)(null),et=(0,a.useRef)([]),es=(0,a.useRef)(!1),ea=(0,a.useRef)(null),en=(0,a.useRef)(null),el=(0,a.useRef)([]),ei=(0,a.useRef)(null),eo=(0,a.useRef)(null),ec=(0,a.useRef)(null),ed=(0,a.useRef)(null),eu=e.ready&&r.ready&&t.ready,ex=e.loading||r.loading||t.loading,ef=(0,a.useMemo)(()=>({llm:k.L.llm.default,stt:k.L.stt.default,tts:k.L.tts.default}),[]),eh=(0,a.useCallback)((e="auto")=>{let r=Y.current;r&&r.scrollTo({top:r.scrollHeight,behavior:e})},[]),em=(0,a.useCallback)(()=>{ee.current||(ee.current=window.setTimeout(()=>{ee.current=null,N((0,R.N)(Z.current)),J.current&&eh("auto")},75))},[eh]);(0,a.useEffect)(()=>{J.current&&eh("auto")},[W.length,eh]),(0,a.useEffect)(()=>{U("undefined"!=typeof navigator&&"gpu"in navigator)},[]);let ep=(0,a.useCallback)(async()=>{if(es.current)return;let e=et.current.shift();if(e){es.current=!0;try{er.current||(er.current=new(window.AudioContext||window.webkitAudioContext));let r=er.current;"suspended"===r.state&&await r.resume();let t=r.createBuffer(1,e.audio.length,e.sampleRate||16e3);t.getChannelData(0).set(e.audio);let s=r.createBufferSource();s.buffer=t,s.playbackRate.value=1.2,s.connect(r.destination),s.onended=()=>{es.current=!1,ep()},s.start()}catch{es.current=!1}}},[]);(0,a.useEffect)(()=>(ed.current=new C.S(e=>{if(!G||!t.ready||!L)return;let r=eo.current;if(!r)return;let s=(0,R.N)(e);s&&L.postMessage({type:"synthesize",data:{text:s,language:"en",speaker:"Lily",requestId:r}})}),()=>{ed.current=null}),[t.ready,G,L]);let eg=(0,a.useCallback)(async()=>{await M()},[M]),eb=(0,a.useCallback)(()=>{$([]),N(""),Z.current="",V(""),ei.current=null,eo.current=null,ed.current?.reset?.(),et.current=[]},[]),ey=(0,a.useCallback)(async r=>{let t=r.trim();if(!t||_)return;if(eu||await eg(),!E||!e.ready)throw Error("LLM worker is not ready.");q(!0),V(""),D("");let s=S("llm");ei.current=s,eo.current=S("tts"),ed.current?.reset?.(),N(""),Z.current="";let a={role:"user",content:t};$(e=>[...e,a]);let n=[{role:"system",content:z},...W,a];E.postMessage({type:"generate",data:{messages:n,requestId:s}})},[_,eg,e.ready,E,W,eu,z]);(0,a.useEffect)(()=>{if(!E)return;let e=e=>{let{type:r,data:t}=e.data||{};if("progress"===r&&t?.status==="stream"){let e=t?.requestId;if(e&&e!==ei.current)return;let r=t?.output||"";Z.current+=r,ed.current?.push?.(r),em()}if("complete"===r){let e="string"==typeof t?{output:t}:t,r=e?.requestId;if(r&&r!==ei.current)return;ee.current&&(window.clearTimeout(ee.current),ee.current=null);let s=(0,R.N)((e?.output||"").trim());s?$(e=>[...e,{role:"assistant",content:s}]):Z.current.trim()&&$(e=>[...e,{role:"assistant",content:(0,R.N)(Z.current.trim())}]),N(""),Z.current="",q(!1),ei.current=null,ed.current?.flush?.(),J.current&&eh("auto")}if("error"===r){let e="string"==typeof t?{message:t}:t,r=e?.requestId;if(r&&r!==ei.current)return;q(!1),ei.current=null}};return E.addEventListener("message",e),()=>{E.removeEventListener("message",e),ee.current&&(window.clearTimeout(ee.current),ee.current=null)}},[E,em,eh]),(0,a.useEffect)(()=>{if(!L)return;let e=e=>{let{type:r,data:t}=e.data||{};if("complete"!==r)return;let s=t?.requestId;if(s&&s!==eo.current||!t?.audio)return;let a=t.audio,n=t.sampling_rate||16e3;et.current.push({audio:a,sampleRate:n}),ep()};return L.addEventListener("message",e),()=>L.removeEventListener("message",e)},[ep,L]),(0,a.useEffect)(()=>{if(!T)return;let e=e=>{let{type:r,data:t}=e.data||{};if("transcription"!==r)return;let s="string"==typeof t?{text:t}:t,a=s?.requestId;if(a&&a!==ec.current)return;let n=(s?.text||"").trim();n&&V(n)};return T.addEventListener("message",e),()=>T.removeEventListener("message",e)},[T]);let ej=(0,a.useCallback)(async e=>{let r=await e.arrayBuffer(),t=new(window.AudioContext||window.webkitAudioContext),s=await t.decodeAudioData(r),a=s.numberOfChannels,n=s.length,l=new Float32Array(n);for(let e=0;e<a;e++){let r=s.getChannelData(e);for(let e=0;e<n;e++)l[e]+=r[e]/a}let i=s.sampleRate;if(16e3===i)return l;let o=i/16e3,c=Math.round(l.length/o),d=new Float32Array(c);for(let e=0;e<c;e++){let r=Math.round(e*o);d[e]=l[Math.min(r,l.length-1)]}return d},[]),eA=(0,a.useCallback)(async()=>{if(_)return;if(eu||await eg(),!T||!r.ready)throw Error("STT worker is not ready.");let e=await navigator.mediaDevices.getUserMedia({audio:!0});en.current=e;let t=new MediaRecorder(e);ea.current=t,el.current=[],F(!0),t.ondataavailable=e=>{e.data&&e.data.size>0&&el.current.push(e.data)},t.onstop=async()=>{F(!1);let e=new Blob(el.current,{type:"audio/webm"});el.current=[];try{let r=await ej(e),t=S("stt");ec.current=t,T.postMessage({type:"transcribe",data:{audio:r,requestId:t}})}catch{}finally{try{en.current?.getTracks().forEach(e=>e.stop())}catch{}en.current=null}},t.start()},[ej,_,eg,eu,r.ready,T]),ew=(0,a.useCallback)(()=>{try{ea.current?.stop()}catch{}},[]),ev=(0,a.useCallback)(async()=>{let e=(Q||P).trim();await ey(e)},[P,Q,ey]),ek=(e,r)=>r.loading?(0,s.jsx)(n.A,{label:`${e}: loading ${r.progress}%`,size:"small"}):r.ready?(0,s.jsx)(n.A,{label:`${e}: ready`,color:"success",size:"small"}):r.error?(0,s.jsx)(n.A,{label:`${e}: error`,color:"error",size:"small"}):(0,s.jsx)(n.A,{label:`${e}: idle`,size:"small"});return(0,s.jsx)(l.default,{sx:{maxWidth:1100,mx:"auto"},children:(0,s.jsx)(i.A,{sx:{p:{xs:2,md:3},borderRadius:3,border:"1px solid",borderColor:"divider"},children:(0,s.jsxs)(o.A,{spacing:2,children:[(0,s.jsxs)(o.A,{direction:{xs:"column",sm:"row"},spacing:1,alignItems:{sm:"center"},justifyContent:"space-between",children:[(0,s.jsxs)(l.default,{children:[(0,s.jsx)(c.A,{variant:"h5",fontWeight:700,children:"AMA"}),(0,s.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:["On-device chat (WebGPU). Models must exist under ",(0,s.jsx)("code",{children:"public/models"}),"."]})]}),(0,s.jsxs)(o.A,{direction:"row",spacing:1,alignItems:"center",flexWrap:"wrap",children:[null===O?(0,s.jsx)(n.A,{label:"Checking WebGPU...",size:"small"}):O?(0,s.jsx)(n.A,{label:"WebGPU detected",color:"success",size:"small"}):(0,s.jsx)(n.A,{label:"WebGPU required",color:"error",size:"small"}),(0,s.jsx)(d.A,{"aria-label":"toggle tts",size:"small",onClick:()=>H(e=>!e),disabled:!t.ready&&!G,children:G?(0,s.jsx)(A.A,{fontSize:"small"}):(0,s.jsx)(w.A,{fontSize:"small"})}),(0,s.jsx)(u.A,{size:"small",variant:"outlined",startIcon:(0,s.jsx)(j.A,{}),disabled:ex,onClick:()=>void eg().catch(()=>{}),children:"Load models"}),(0,s.jsx)(u.A,{size:"small",color:"inherit",startIcon:(0,s.jsx)(y,{}),onClick:eb,disabled:_||ex,children:"Clear"})]})]}),(0,s.jsx)(x.A,{}),(0,s.jsxs)(o.A,{spacing:1,children:[(0,s.jsx)(c.A,{variant:"subtitle2",children:"Runtime"}),(0,s.jsxs)(o.A,{direction:"row",spacing:1,flexWrap:"wrap",alignItems:"center",children:[ek("LLM",e),ek("STT",r),ek("TTS",t),(0,s.jsx)(n.A,{label:`LLM: ${I}`,size:"small",variant:"outlined"})]}),(e.error||r.error||t.error)&&(0,s.jsxs)(f.A,{severity:"error",children:[e.error||r.error||t.error,(0,s.jsx)(l.default,{sx:{mt:1},children:(0,s.jsxs)(c.A,{variant:"body2",children:["Expected local ORT assets: ",(0,s.jsx)("code",{children:"/onnxruntime"}),". Expected local models: ",(0,s.jsx)("code",{children:"/models"}),"."]})})]}),(0,s.jsxs)(l.default,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr 1fr"},gap:1},children:[(0,s.jsxs)(i.A,{variant:"outlined",sx:{p:1.25},children:[(0,s.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"LLM model"}),(0,s.jsx)(c.A,{variant:"body2",sx:{wordBreak:"break-word"},children:ef.llm})]}),(0,s.jsxs)(i.A,{variant:"outlined",sx:{p:1.25},children:[(0,s.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"STT model"}),(0,s.jsx)(c.A,{variant:"body2",sx:{wordBreak:"break-word"},children:ef.stt})]}),(0,s.jsxs)(i.A,{variant:"outlined",sx:{p:1.25},children:[(0,s.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"TTS model"}),(0,s.jsx)(c.A,{variant:"body2",sx:{wordBreak:"break-word"},children:ef.tts})]})]})]}),(0,s.jsx)(x.A,{}),(0,s.jsx)(i.A,{ref:Y,onScroll:()=>{let e=Y.current;e&&(J.current=e.scrollHeight-e.scrollTop-e.clientHeight<120)},sx:{p:2,height:{xs:420,md:520},overflowY:"auto",bgcolor:"background.default",border:"1px solid",borderColor:"divider",borderRadius:2},children:(0,s.jsxs)(o.A,{spacing:1.5,children:[0===W.length&&!B&&(0,s.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Ask anything about Kaushal’s background, experience, and projects."}),W.map((e,r)=>(0,s.jsx)(l.default,{sx:{display:"flex",justifyContent:"user"===e.role?"flex-end":"flex-start"},children:(0,s.jsx)(l.default,{sx:{maxWidth:"85%",px:1.5,py:1,borderRadius:2,bgcolor:"user"===e.role?"primary.main":"background.paper",color:"user"===e.role?"primary.contrastText":"text.primary",border:"assistant"===e.role?"1px solid":"none",borderColor:"divider"},children:(0,s.jsx)(c.A,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:e.content})})},`${e.role}-${r}`)),B&&(0,s.jsx)(l.default,{sx:{display:"flex",justifyContent:"flex-start"},children:(0,s.jsxs)(l.default,{sx:{maxWidth:"85%",px:1.5,py:1,borderRadius:2,bgcolor:"background.paper",border:"1px solid",borderColor:"divider"},children:[(0,s.jsx)(c.A,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:B}),(0,s.jsxs)(l.default,{sx:{display:"flex",alignItems:"center",gap:1,mt:1},children:[(0,s.jsx)(h.A,{size:14}),(0,s.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Generating…"})]})]})}),Q&&(0,s.jsx)(f.A,{severity:"info",children:(0,s.jsxs)(c.A,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:["Transcript: ",Q]})}),(0,s.jsx)("div",{ref:X})]})}),(0,s.jsxs)(o.A,{direction:{xs:"column",sm:"row"},spacing:1,alignItems:"stretch",children:[(0,s.jsx)(m.A,{id:"ama-message",name:"ama-message",fullWidth:!0,placeholder:eu?"Type a message…":"Load models to start…",value:P,onChange:e=>D(e.target.value),disabled:_||ex,multiline:!0,maxRows:4,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),ev().catch(()=>{}))}}),(0,s.jsxs)(o.A,{direction:"row",spacing:1,alignItems:"center",justifyContent:"flex-end",children:[(0,s.jsx)(d.A,{"aria-label":K?"stop recording":"start recording",color:K?"error":"primary",onClick:()=>{K?ew():eA().catch(()=>{})},disabled:_||ex,children:K?(0,s.jsx)(g.A,{}):(0,s.jsx)(p.A,{})}),(0,s.jsx)(u.A,{variant:"contained",endIcon:(0,s.jsx)(b.A,{}),onClick:()=>void ev().catch(()=>{}),disabled:_||ex||!P.trim()&&!Q.trim(),children:"Send"})]})]})]})})})}},7580:(e,r,t)=>{Promise.resolve().then(t.bind(t,1508)),Promise.resolve().then(t.bind(t,6430)),Promise.resolve().then(t.bind(t,804)),Promise.resolve().then(t.bind(t,7911)),Promise.resolve().then(t.bind(t,2849))}},e=>{e.O(0,[361,688,911,441,794,358],()=>e(e.s=7580)),_N_E=e.O()}]);