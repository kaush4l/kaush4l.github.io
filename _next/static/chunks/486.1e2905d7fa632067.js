(()=>{var e,t,o,r,a,s,l={4486:(e,t,o)=>{"use strict";var r=o(9868);r._K2.allowLocalModels=!1,r._K2.useBrowserCache=!0;let a=null,s=null,l="vision-language";async function n(e,t){let o="wasm";if("gpu"in navigator)try{await navigator.gpu.requestAdapter()&&(o="webgpu")}catch(e){console.warn("WebGPU not available, falling back to wasm")}console.log(`[LLM Worker] Loading ${e} on ${o}`);let n=new Map,i=e=>{if(e.file){if(n.set(e.file,e),"progress"===e.status){let e=0,o=0;for(let t of n.values())t.loaded&&t.total&&(e+=t.loaded,o+=t.total);o>0&&t({status:"progress",progress:e/o*100})}}else t(e)};try{l="vision-language",a=await r.oye.from_pretrained(e,{progress_callback:i});try{console.log(`[LLM Worker] Attempting to load ${e} as AutoModelForImageTextToText`),s=await r.mvA.from_pretrained(e,{dtype:{embed_tokens:"fp16",vision_encoder:"q4",decoder_model_merged:"q4"},device:o,progress_callback:i}),l="vision-language"}catch(t){console.warn("[LLM Worker] Failed to load as Vision model, falling back to CausalLM",t),s=await r.W6E.from_pretrained(e,{dtype:{embed_tokens:"fp16",decoder_model_merged:"q4f16"},device:o,progress_callback:i}),l="text-only"}console.log(`[LLM Worker] Successfully loaded ${e}`)}catch(t){throw console.error(`[LLM Worker] Failed to load model ${e}:`,t),t}}self.addEventListener("message",async e=>{let{type:t,data:o}=e.data;if("load"===t)try{let e=o.model;await n(e,e=>{self.postMessage({type:"progress",data:e})}),self.postMessage({type:"ready"})}catch(e){self.postMessage({type:"error",data:e.message})}else if("generate"===t)try{let e;if(!a||!s)throw Error("Model not loaded");let{messages:t,images:n=[]}=o;if("text-only"===l){console.log("[LLM Worker] Processing text-only generation...");let o=a?.tokenizer||a,r=o.apply_chat_template(t,{add_generation_prompt:!0,tokenize:!1});console.log("[LLM Worker] Text Prompt:",r),e=await o(r,{add_special_tokens:!1})}else{let o=n.length>0,s=t.map(e=>"user"!==e.role||e.content.includes("<image>")?e:{...e,content:`<image>${e.content}`}),l=a.apply_chat_template(s,{add_generation_prompt:!0,tokenize:!1});if(console.log("[LLM Worker] Vision Prompt:",l),o){console.log("[LLM Worker] Processing with user image...");let t=await (0,r.vaw)(n[0]);e=await a(t,l,{add_special_tokens:!1})}else{console.log("[LLM Worker] No image provided, using placeholder...");let t=await (0,r.vaw)("https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/bee.jpg");e=await a(t,l,{add_special_tokens:!1})}}console.log("[LLM Worker] Inputs ready, starting generation...");let i=a?.tokenizer||a,p=new r.T1P(i,{skip_prompt:!0,skip_special_tokens:!0,callback_function:e=>{self.postMessage({type:"progress",data:{status:"stream",output:e}})}}),c=await s.generate({...e,max_new_tokens:2048,do_sample:!1,repetition_penalty:1.2,streamer:p}),d=i.batch_decode(c.slice(null,[e.input_ids.dims.at(-1),null]),{skip_special_tokens:!0});self.postMessage({type:"complete",data:d[0]?.trim()||""})}catch(e){console.error("[LLM Worker] Generation error:",e),self.postMessage({type:"error",data:e.message})}})}},n={};function i(e){var t=n[e];if(void 0!==t)return t.exports;var o=n[e]={exports:{}},r=!0;try{l[e](o,o.exports,i),r=!1}finally{r&&delete n[e]}return o.exports}i.m=l,i.x=()=>{var e=i.O(void 0,[803,643,402],()=>i(4486));return i.O(e)},e=[],i.O=(t,o,r,a)=>{if(o){a=a||0;for(var s=e.length;s>0&&e[s-1][2]>a;s--)e[s]=e[s-1];e[s]=[o,r,a];return}for(var l=1/0,s=0;s<e.length;s++){for(var[o,r,a]=e[s],n=!0,p=0;p<o.length;p++)(!1&a||l>=a)&&Object.keys(i.O).every(e=>i.O[e](o[p]))?o.splice(p--,1):(n=!1,a<l&&(l=a));if(n){e.splice(s--,1);var c=r();void 0!==c&&(t=c)}}return t},i.d=(e,t)=>{for(var o in t)i.o(t,o)&&!i.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce((t,o)=>(i.f[o](e,t),t),[])),i.u=e=>"static/chunks/"+(({643:"037f3a08",803:"adda3502"})[e]||e)+"."+({402:"4be146a973a65eed",643:"fd9448469f263f1d",803:"4aa9439e4b0f4449"})[e]+".js",i.miniCssF=e=>{},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.U=function(e){var t=new URL(e,"x:/"),o={};for(var r in t)o[r]=t[r];for(var r in o.href=e,o.pathname=e.replace(/[?#].*/,""),o.origin=o.protocol="",o.toString=o.toJSON=()=>e,o)Object.defineProperty(this,r,{enumerable:!0,configurable:!0,value:o[r]})},i.U.prototype=URL.prototype,i.tt=()=>(void 0===t&&(t={createScriptURL:e=>e},"undefined"!=typeof trustedTypes&&trustedTypes.createPolicy&&(t=trustedTypes.createPolicy("nextjs#bundler",t))),t),i.tu=e=>i.tt().createScriptURL(e),i.p="/_next/",o={486:1},i.f.i=(e,t)=>{o[e]||importScripts(i.tu(i.p+i.u(e)))},a=(r=self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push.bind(r),r.push=e=>{var[t,r,s]=e;for(var l in r)i.o(r,l)&&(i.m[l]=r[l]);for(s&&s(i);t.length;)o[t.pop()]=1;a(e)},s=i.x,i.x=()=>Promise.all([803,643,402].map(i.e,i)).then(s),_N_E=i.x()})();